{"ast":null,"code":"var _jsxFileName = \"/home/i/Documents/projects/social-network/src/components/Profile/ProfileInfo/ProfileInfo.jsx\";\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { Field, reduxForm } from 'redux-form';\nimport { requiredFields, maxLengthCreator, minLengthOrNothingCreator, emailValidate, phoneNumberValidate } from '../../../utils/validators.js';\nimport styles from './ProfileInfo.module.css';\nimport WithAuthData from '../../../hocs/WithAuthData';\nimport { updateProfile, getProfile } from '../../../reducers/profileReducer';\nimport { Input2, InputImage, Button, ErrorForm } from '../../commons/FormsControls/FormsControls.jsx';\nimport poster from '../../../assets/images/space.jpg';\nimport default_avatar from '../../../assets/images/avatar_default.png';\nimport FetchingToggle from '../../commons/FetchingToggle/FetchingToggle';\nconst maxLength30 = maxLengthCreator(30);\n\nclass ProfileInfo extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      editMode: false,\n      isFetching: false\n    };\n\n    this.changeEditMode = () => {\n      this.setState({\n        editMode: !this.state.editMode\n      });\n    };\n\n    this.changeIsFetching = () => {\n      this.setState({\n        isFetching: !this.state.isFetching\n      });\n    };\n\n    this.onSubmit = async ({\n      phone,\n      address,\n      age,\n      picture\n    }) => {\n      let formData = new FormData();\n      if (phone) formData.append('phone', phone);\n      if (address) formData.append('address', address);\n      if (age) formData.append('age', age);\n      if (picture) formData.append('image', picture);\n      let options = {\n        formData,\n        id: this.props.auth.id,\n        token: this.props.auth.token\n      };\n      this.changeIsFetching();\n      this.props.updateProfile(options).then(res => {\n        this.changeIsFetching();\n        this.changeEditMode();\n        this.props.changeVisibleModal(false); // toto возможно нужно будет удалить 7 строк снизу\n\n        let user_id = this.props.profile.id;\n        user_id = user_id;\n        let options = {\n          user_id,\n          id: this.props.auth ? this.props.auth.id : '',\n          token: this.props.auth ? this.props.auth.token : ''\n        };\n        this.props.getProfile(options);\n      });\n    };\n  }\n\n  render() {\n    let avatar_img = this.props.profile.photos.small || default_avatar;\n    let save_button = React.createRef();\n    let avatar_ref = React.createRef();\n    let change_photo_button = React.createRef();\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.wrapper,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.avatar,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      ref: avatar_ref,\n      src: avatar_img,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 21\n      }\n    }), this.state.editMode && /*#__PURE__*/React.createElement(\"div\", {\n      className: styles['change-photo-button'],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 48\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: styles['button-wrp'],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      ref: change_photo_button,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 33\n      }\n    }, \"CHANGE PHOTO\")))), /*#__PURE__*/React.createElement(ProfileInfoReduxForm, {\n      onSubmit: this.onSubmit,\n      auth: this.props.auth,\n      profile: this.props.profile,\n      changeEditMode: this.changeEditMode.bind(this),\n      state: this.state,\n      avatar_ref: avatar_ref,\n      change_photo_button: change_photo_button,\n      editMode: this.state.editMode,\n      save_button: save_button,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 17\n      }\n    }));\n  }\n\n}\n\n;\n\nclass ProfileInfoForm extends React.Component {\n  render() {\n    this.props.editMode || this.props.reset();\n    let info = [['name', 'Enter your name', [requiredFields]], ['email', 'Enter your email', [requiredFields, emailValidate]], ['phone', 'Enter your phone number', [phoneNumberValidate]], ['address', 'Enter your address'], ['age', 'Enter your age']];\n    info = info.filter(item => this.props.editMode || Object.keys(this.props.initialValues).includes(item[0])).map(item => {\n      return /*#__PURE__*/React.createElement(\"li\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 28\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: styles['item-field'],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 25\n        }\n      }, item[0] + ': '), /*#__PURE__*/React.createElement(\"div\", {\n        className: styles['item-data'],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(Field, {\n        name: item[0],\n        autoFocus: true,\n        validate: item[2],\n        editMode: item[0] === 'name' || item[0] === 'email' ? false : this.props.editMode,\n        component: Input2,\n        placeholder: item[1],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 29\n        }\n      })));\n    });\n    console.log(this.props.avatar_ref.current);\n\n    if (this.props.avatar_ref.current) {\n      this.props.avatar_ref.current.innerHTML = `<img src=\"\" />`;\n    }\n\n    return /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: this.props.handleSubmit,\n      className: styles['list-info'],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 16\n      }\n    }, /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }\n    }, info, this.props.state.editMode && /*#__PURE__*/React.createElement(Field, {\n      name: \"picture\",\n      component: InputImage,\n      change_photo_button: this.props.change_photo_button,\n      type: \"file\",\n      value: null,\n      avatar_ref: this.props.avatar_ref,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 28\n      }\n    })), this.props.auth.id == this.props.profile.id && /*#__PURE__*/React.createElement(\"div\", {\n      className: styles['buttons-wrapper'],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 24\n      }\n    }, !this.props.state.editMode && /*#__PURE__*/React.createElement(\"button\", {\n      className: 'commons-modal-button',\n      onClick: e => {\n        e.preventDefault();\n        this.props.changeEditMode();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 32\n      }\n    }, \"CHANGE\") || /*#__PURE__*/React.createElement(\"button\", {\n      name: 'submit',\n      type: \"submit\",\n      disabled: this.props.state.isFetching,\n      className: 'commons-modal-button',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 32\n      }\n    }, \"SAVE\"), this.props.state.isFetching && /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        float: 'left',\n        height: '35px',\n        width: '35px',\n        padding: '5px',\n        'box-sizing': 'border-box',\n        'margin-right': '10px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 40\n      }\n    }, /*#__PURE__*/React.createElement(FetchingToggle, {\n      background: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 41\n      }\n    })), this.props.state.editMode && /*#__PURE__*/React.createElement(\"button\", {\n      className: 'commons-modal-button' + ' ' + styles['change-info-cancel'],\n      onClick: this.props.changeEditMode,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 48\n      }\n    }, \"CANCEL\")));\n  }\n\n}\n\n;\nlet ProfileInfoReduxForm = compose(connect(state => ({\n  initialValues: { ...state.profilePage.profile,\n    ...state.profilePage.profile.info[0]\n  } // pull initial values from account reducer\n\n})), reduxForm({\n  form: 'profile-info'\n}))(ProfileInfoForm);\n\nlet mapStateToProps = state => {\n  return {\n    profile: state.profilePage.profile\n  };\n};\n\nexport default compose(connect(mapStateToProps, {\n  updateProfile,\n  getProfile\n}), WithAuthData)(ProfileInfo);","map":{"version":3,"sources":["/home/i/Documents/projects/social-network/src/components/Profile/ProfileInfo/ProfileInfo.jsx"],"names":["React","connect","compose","Field","reduxForm","requiredFields","maxLengthCreator","minLengthOrNothingCreator","emailValidate","phoneNumberValidate","styles","WithAuthData","updateProfile","getProfile","Input2","InputImage","Button","ErrorForm","poster","default_avatar","FetchingToggle","maxLength30","ProfileInfo","Component","state","editMode","isFetching","changeEditMode","setState","changeIsFetching","onSubmit","phone","address","age","picture","formData","FormData","append","options","id","props","auth","token","then","res","changeVisibleModal","user_id","profile","render","avatar_img","photos","small","save_button","createRef","avatar_ref","change_photo_button","wrapper","avatar","bind","ProfileInfoForm","reset","info","filter","item","Object","keys","initialValues","includes","map","console","log","current","innerHTML","handleSubmit","e","preventDefault","float","height","width","padding","ProfileInfoReduxForm","profilePage","form","mapStateToProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {connect} from 'react-redux';\nimport {compose} from 'redux';\nimport {Field, reduxForm} from 'redux-form';\nimport {requiredFields, maxLengthCreator, minLengthOrNothingCreator, emailValidate, phoneNumberValidate} from '../../../utils/validators.js';\nimport styles from './ProfileInfo.module.css';\nimport WithAuthData from '../../../hocs/WithAuthData';\nimport {updateProfile, getProfile} from '../../../reducers/profileReducer';\n\nimport {Input2, InputImage, Button, ErrorForm} from '../../commons/FormsControls/FormsControls.jsx';\nimport poster from '../../../assets/images/space.jpg';\nimport default_avatar from '../../../assets/images/avatar_default.png';\nimport FetchingToggle from '../../commons/FetchingToggle/FetchingToggle';\n\nconst maxLength30 = maxLengthCreator(30);\n\nclass ProfileInfo extends React.Component {\n\n    state = {\n        editMode: false,\n        isFetching: false,\n    }\n\n    changeEditMode = () => {\n        this.setState({editMode: !this.state.editMode});\n    }\n\n    changeIsFetching = () => {\n        this.setState({isFetching: !this.state.isFetching});\n    }\n\n    onSubmit = async ({phone, address, age, picture}) => {\n        let formData = new FormData();\n        if(phone)\n            formData.append('phone', phone);\n        if(address)\n            formData.append('address', address);\n        if(age)\n            formData.append('age', age);\n        if(picture)\n            formData.append('image', picture);\n\n        let options = {\n            formData,\n            id: this.props.auth.id,\n            token: this.props.auth.token,\n        };\n\n        this.changeIsFetching();\n        this.props.updateProfile(options)\n            .then(res => {\n                this.changeIsFetching();\n                this.changeEditMode();\n                this.props.changeVisibleModal(false);\n                // toto возможно нужно будет удалить 7 строк снизу\n                let user_id = this.props.profile.id;\n                user_id = user_id;\n                let options = {\n                    user_id,\n                    id: this.props.auth? this.props.auth.id: '',\n                    token: this.props.auth? this.props.auth.token: '',\n                };\n                this.props.getProfile(options);\n            });\n    }\n\n    render () {\n        let avatar_img = this.props.profile.photos.small || default_avatar;\n        let save_button = React.createRef();\n        let avatar_ref = React.createRef();\n        let change_photo_button = React.createRef();\n        return (\n            <div className={styles.wrapper}>\n                <div className={styles.avatar}>\n                    <img ref={avatar_ref} src={avatar_img} />\n                    {\n                        this.state.editMode && <div className={styles['change-photo-button']} >\n                            <div className={styles['button-wrp']} >\n                                <button ref={change_photo_button} >\n                                    CHANGE PHOTO\n                                </button>\n                            </div>\n                        </div>\n                    }\n                </div>\n\n                <ProfileInfoReduxForm onSubmit={this.onSubmit} \n                    auth={this.props.auth}\n                    profile={this.props.profile}\n                    changeEditMode={this.changeEditMode.bind(this)}\n                    state={this.state}\n                    avatar_ref={avatar_ref}\n                    change_photo_button={change_photo_button}\n                    editMode={this.state.editMode} save_button={save_button} />\n                </div>\n        );\n    }\n};\n\nclass ProfileInfoForm extends React.Component {\n\n    render() {\n\n        this.props.editMode || this.props.reset();\n        let info = [\n            ['name', 'Enter your name', [requiredFields]],\n            ['email', 'Enter your email', [requiredFields, emailValidate]],\n            ['phone', 'Enter your phone number', [phoneNumberValidate]],\n            ['address', 'Enter your address'],\n            ['age', 'Enter your age'],\n        ];\n\n        info = info\n            .filter(item => \n                this.props.editMode || Object.keys(this.props.initialValues).includes(item[0]))\n                .map(item => {\n                    return <li>\n                        <span className={styles['item-field']}>\n                            {item[0] + ': '}\n                        </span>\n                        <div className={styles['item-data']}>\n\n                            <Field name={item[0]} autoFocus={true} \n                                validate={item[2]}\n                                editMode={ item[0] === 'name' || item[0] === 'email'? false: this.props.editMode}\n                                component={Input2} \n                                placeholder={item[1]} />\n                            </div>\n\n                        </li>\n                });\n        console.log(this.props.avatar_ref.current);\n        if(this.props.avatar_ref.current){\n            this.props.avatar_ref.current.innerHTML = `<img src=\"\" />`;\n        }\n\n        return <form onSubmit={this.props.handleSubmit} className={styles['list-info']}>\n            <ul>\n                {info}\n                {\n                    this.props.state.editMode \n                        && <Field name=\"picture\" component={InputImage} \n                            change_photo_button={this.props.change_photo_button}\n                            type=\"file\" value={null} avatar_ref={this.props.avatar_ref} />\n                }\n                        </ul>\n                        {\n                            this.props.auth.id == this.props.profile.id\n                    && <div className={styles['buttons-wrapper']}>\n                        {\n                            !this.props.state.editMode \n                            && <button className={'commons-modal-button'}\n                                onClick={(e) => {\n                                    e.preventDefault();\n                                    this.props.changeEditMode();\n                                }\n                                } >\n                                CHANGE\n                            </button>\n                            || <button name={'submit'} type='submit' \n                                disabled={this.props.state.isFetching}\n                                className={'commons-modal-button'} >\n                                SAVE\n                            </button>\n                        }\n                            {\n                                this.props.state.isFetching\n                                    && <div  style={ {float: 'left', \n                                        height: '35px', width: '35px',\n                                        padding: '5px', 'box-sizing': 'border-box',\n                                        'margin-right': '10px'} } >\n                                        <FetchingToggle background={true} />\n                                    </div>\n                            }\n                                    {\n                                        this.props.state.editMode \n                                            && <button \n                                                className={'commons-modal-button' + ' ' \n                                                        + styles['change-info-cancel']}\n                                                onClick={this.props.changeEditMode} >\n                                                CANCEL\n                                            </button>\n                                    }\n                                        </div>\n            }\n\n                                    </form>\n    }\n};\n\n\nlet ProfileInfoReduxForm = compose(\n    connect(\n        state => ({\n            initialValues: {\n                ...state.profilePage.profile,\n                ...state.profilePage.profile.info[0],\n            }// pull initial values from account reducer\n        })\n    ),\n    reduxForm({form: 'profile-info'}),\n)(ProfileInfoForm)\n\nlet mapStateToProps = (state) => {\n    return {\n        profile: state.profilePage.profile,\n    }\n};\n\nexport default compose(\n    connect(mapStateToProps, {updateProfile, getProfile}),\n    WithAuthData)\n(ProfileInfo);\n"]},"metadata":{},"sourceType":"module"}